class TossIntegration{constructor(){this.isAuthenticated=!1,this.userInfo=null,this.authToken=null,this.isAdReady=!1,this.userKey=null,this.adGroupId=null}async getUserKeyForGame(){try{console.log("ğŸ”‘ ê²Œì„ ìœ ì € í‚¤ ìš”ì²­ ì‹œì‘");const o=window.getUserKeyForGame;if("function"==typeof o){console.log("âœ“ getUserKeyForGame í•¨ìˆ˜ ë°œê²¬");const e=await o();return console.log("ğŸ“¨ getUserKeyForGame ì‘ë‹µ:",e),e&&"HASH"===e.type?(this.userKey=e.hash,console.log("âœ… ê²Œì„ ìœ ì € í‚¤ íšë“:",this.userKey),this.userKey):"INVALID_CATEGORY"===e?(console.error("âŒ ê²Œì„ ì¹´í…Œê³ ë¦¬ê°€ ì•„ë‹™ë‹ˆë‹¤"),console.error('â†’ Toss ê°œë°œì ì½˜ì†”ì—ì„œ ì•± ì¹´í…Œê³ ë¦¬ë¥¼ "ê²Œì„"ìœ¼ë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”!'),this.userKey=this.generateTestUserKey(),this.userKey):(console.error("âŒ ìœ ì € í‚¤ íšë“ ì‹¤íŒ¨:",e),this.userKey=this.generateTestUserKey(),this.userKey)}return console.warn("âš ï¸ Toss SDK ì—†ìŒ - í…ŒìŠ¤íŠ¸ ëª¨ë“œë¡œ ì„ì‹œ í‚¤ ìƒì„±"),console.log("typeof getUserKeyForGame:",typeof getUserKeyForGame),this.userKey=this.generateTestUserKey(),this.userKey}catch(o){return console.error("getUserKeyForGame ì—ëŸ¬:",o),console.error("ì—ëŸ¬ ìƒì„¸:",o.message,o.stack),this.userKey=this.generateTestUserKey(),this.userKey}}generateTestUserKey(){let o=localStorage.getItem("test_user_key");return o||(o="test_"+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),localStorage.setItem("test_user_key",o)),o}isLeaderboardAvailable(){return"function"==typeof window.openGameCenterLeaderboard}isAdAvailable(){return void 0!==window.GoogleAdMob&&"function"==typeof window.GoogleAdMob.loadAppsInTossAdMob&&"function"==typeof window.GoogleAdMob.showAppsInTossAdMob}isInviteFriendsAvailable(){return"function"==typeof window.contactsViral}isTossSDKAvailable(){return this.isLeaderboardAvailable()||this.isAdAvailable()||this.isInviteFriendsAvailable()}getEnvironmentInfo(){return{env:window.getOperationalEnvironment?window.getOperationalEnvironment():"unknown",tossVersion:window.getTossAppVersion?window.getTossAppVersion():"unknown",platform:window.getPlatformOS?window.getPlatformOS():"unknown",leaderboard:this.isLeaderboardAvailable(),ad:this.isAdAvailable(),invite:this.isInviteFriendsAvailable()}}inviteFriends(o){const e=window.contactsViral;if(void 0===e)return console.warn("âš ï¸ contactsViral SDK not loaded - í…ŒìŠ¤íŠ¸ ëª¨ë“œ"),o&&setTimeout(()=>o(1),500),()=>{};try{return e({options:{moduleId:"4448b227-295f-42a7-bb67-b7c6a922bd4f"},onEvent:e=>{if(console.log("ì¹œêµ¬ ì´ˆëŒ€ ì´ë²¤íŠ¸:",e.type,e.data),"sendViral"===e.type){const s=e.data.rewardAmount||1;console.log(`âœ… ì¹œêµ¬ ì´ˆëŒ€ ì„±ê³µ! í•˜íŠ¸ ${s}ê°œ íšë“`),o&&o(s)}else"close"===e.type&&console.log("ì¹œêµ¬ ì´ˆëŒ€ ë‹«í˜:",e.data.closeReason)},onError:o=>{console.error("âŒ ì¹œêµ¬ ì´ˆëŒ€ ì—ëŸ¬:",o),window.showTossModal&&window.showTossModal({title:"ì¹œêµ¬ ì´ˆëŒ€ ì˜¤ë¥˜",message:"ì¹œêµ¬ ì´ˆëŒ€ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆì–´ìš”.\në‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",buttons:[{text:"í™•ì¸",color:"secondary"}]})}})}catch(o){return console.error("ì¹œêµ¬ ì´ˆëŒ€ ì—ëŸ¬:",o),()=>{}}}async initialize(){try{await this.getUserKeyForGame();const o=new URLSearchParams(window.location.search);return this.authToken=o.get("token")||sessionStorage.getItem("toss_token"),this.authToken?(sessionStorage.setItem("toss_token",this.authToken),await this.fetchUserInfo(),!0):null!==this.userKey}catch(o){return console.error("Toss initialization error:",o),!1}}async fetchUserInfo(){try{const o=await fetch("/api/toss/user",{headers:{Authorization:`Bearer ${this.authToken}`}});if(o.ok)return this.userInfo=await o.json(),this.isAuthenticated=!0,console.log("Toss user authenticated:",this.userInfo),this.userInfo;throw new Error("Failed to fetch user info")}catch(o){return console.error("Fetch user info error:",o),this.isAuthenticated=!1,null}}async submitGameCenterScore(o){try{console.log("ğŸ® Game Center ì ìˆ˜ ì œì¶œ ì‹œë„:",o);const e=window.submitGameCenterLeaderBoardScore;if("function"==typeof e){console.log("âœ“ submitGameCenterLeaderBoardScore í•¨ìˆ˜ ë°œê²¬");const s=await e({score:o.toString()});return console.log("ğŸ“¨ API ì‘ë‹µ:",s),s?"SUCCESS"===s.statusCode?(console.log("âœ… Game Center ì ìˆ˜ ì œì¶œ ì™„ë£Œ:",o),!0):(console.error("âŒ Game Center ì ìˆ˜ ì œì¶œ ì‹¤íŒ¨:",s),console.error("ì‹¤íŒ¨ ìƒì„¸:",JSON.stringify(s)),!1):(console.warn("âš ï¸ Toss ì•± ë²„ì „ì´ ë‚®ì•„ì„œ ì ìˆ˜ ì œì¶œ ë¶ˆê°€ (5.221.0 ì´ìƒ í•„ìš”)"),!1)}return console.warn("âš ï¸ Toss SDK ì—†ìŒ - í…ŒìŠ¤íŠ¸ ëª¨ë“œ (ì ìˆ˜ ì œì¶œ ì‹œë®¬ë ˆì´ì…˜)"),console.log("ğŸ“Š ì œì¶œí•  ì ìˆ˜:",o),!0}catch(o){return console.error("âŒ Game Center ì ìˆ˜ ì œì¶œ ì—ëŸ¬:",o),console.error("ì—ëŸ¬ ìƒì„¸:",o.message,o.stack),!1}}async openGameCenterLeaderboard(){try{console.log("ğŸ† Game Center ë¦¬ë”ë³´ë“œ ì—´ê¸° ì‹œë„");const o=window.openGameCenterLeaderboard;return"function"==typeof o?(console.log("âœ“ openGameCenterLeaderboard í•¨ìˆ˜ ë°œê²¬"),void 0===await o()&&void 0!==o?(console.warn("âš ï¸ Toss ì•± ë²„ì „ ë¯¸ì§€ì› (v5.221.0 ì´ìƒ í•„ìš”)"),{success:!1,reason:"version"}):(console.log("âœ… Game Center ë¦¬ë”ë³´ë“œ ì—´ë¦¼"),{success:!0})):(console.warn("âš ï¸ Toss SDK ì—†ìŒ - í…ŒìŠ¤íŠ¸ ëª¨ë“œ"),console.log("typeof window.openGameCenterLeaderboard:",typeof window.openGameCenterLeaderboard),console.log("ì „ì—­ window í™•ì¸:",Object.keys(window).filter(o=>o.includes("Game")||o.includes("game"))),{success:!1,reason:"no_sdk"})}catch(o){return console.error("âŒ Game Center ë¦¬ë”ë³´ë“œ ì—´ê¸° ì—ëŸ¬:",o),console.error("ì—ëŸ¬ ìƒì„¸:",o.message,o.stack),{success:!1,reason:"error",error:o}}}goBackToToss(){window.TossApps?window.TossApps.close():(console.log("Toss Apps SDK not available"),window.history.back())}async requestPayment(o,e){if(!this.isAuthenticated)throw new Error("Not authenticated");try{if(window.TossPayments){const s=window.TossPayments("YOUR_CLIENT_KEY");await s.requestPayment("ì¹´ë“œ",{amount:o,orderId:`DRONE_${Date.now()}`,orderName:e,customerName:this.userInfo?.name||"Player",successUrl:window.location.origin+"/payment/success",failUrl:window.location.origin+"/payment/fail"})}}catch(o){throw console.error("Payment error:",o),o}}async loadRewardedAd(o){console.log("ğŸ“¥ loadRewardedAd í˜¸ì¶œë¨, adGroupId:",o);const e=window.getOperationalEnvironment?window.getOperationalEnvironment():"unknown";console.log("  - ì‹¤í–‰ í™˜ê²½:",e);const s=window.GoogleAdMob;if(void 0===s||!s.loadAppsInTossAdMob)return console.warn("âš ï¸ GoogleAdMob SDK not loaded (í…ŒìŠ¤íŠ¸ ëª¨ë“œ)"),this.isAdReady=!0,!1;const n=s.loadAppsInTossAdMob;if(console.log("  - GoogleAdMob ì¡´ì¬:",void 0!==s),console.log("  - loadAppsInTossAdMob ì¡´ì¬:","function"==typeof n),console.log("  - isSupported í•¨ìˆ˜ ì¡´ì¬:","function"==typeof n.isSupported),"function"==typeof n.isSupported){const o=n.isSupported();if(console.log("  - isSupported() ë°˜í™˜ê°’:",o),!o)return console.error("âŒ ê´‘ê³  ë¡œë“œ ë¶ˆê°€: í˜„ì¬ í™˜ê²½ì—ì„œ AdMobì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤"),console.error("ğŸ’¡ í˜„ì¬ í™˜ê²½:",e),"sandbox"===e?(console.warn("âš ï¸ ìƒŒë“œë°•ìŠ¤ í™˜ê²½ì…ë‹ˆë‹¤. ë³´ìƒí˜• ê´‘ê³ ëŠ” ìƒŒë“œë°•ìŠ¤ì—ì„œ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."),console.warn("â†’ í”„ë¡œë•ì…˜ í™˜ê²½(ì‹¤ì œ Toss ì•±)ì— ë°°í¬í•´ì•¼ í•©ë‹ˆë‹¤."),this.isAdReady=!0,!1):(console.error("  â–¡ Toss ì•± ë²„ì „ì´ ë‚®ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤ (SDK 1.0.3 ì´ìƒ í•„ìš”)"),!1)}try{return this.adGroupId=o,await n({options:{adGroupId:this.adGroupId},onEvent:o=>{"loaded"===o.type&&(console.log("âœ… ë³´ìƒí˜• ê´‘ê³  ë¡œë“œ ì™„ë£Œ",o.data),this.isAdReady=!0)},onError:o=>{console.error("âŒ ê´‘ê³  ë¡œë“œ ì‹¤íŒ¨:",o),this.isAdReady=!1}}),!0}catch(o){return console.error("ê´‘ê³  ë¡œë“œ ì—ëŸ¬:",o),!1}}async showRewardedAd(o,e){console.log("ğŸ¬ showRewardedAd í˜¸ì¶œë¨, adGroupId:",o),console.log("ğŸ“Š ë””ë²„ê¹… ì •ë³´:");const s=window.GoogleAdMob;if(console.log("  - GoogleAdMob ì¡´ì¬:",void 0!==s),console.log("  - isAdReady:",this.isAdReady),void 0===s||!s.showAppsInTossAdMob)return console.warn("âš ï¸ GoogleAdMob SDK not loaded - í…ŒìŠ¤íŠ¸ ëª¨ë“œë¡œ ë³´ìƒ ì§€ê¸‰"),e&&setTimeout(()=>e({unitType:"test",unitAmount:1}),100),!0;const n=s.showAppsInTossAdMob;if(console.log("  - showAppsInTossAdMob ì¡´ì¬:","function"==typeof n),console.log("  - isSupported í•¨ìˆ˜ ì¡´ì¬:","function"==typeof n.isSupported),"function"==typeof n.isSupported){const o=n.isSupported();if(console.log("  - isSupported() ë°˜í™˜ê°’:",o),!o)return console.error("âŒ í˜„ì¬ í™˜ê²½ì—ì„œ AdMobì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤"),console.error("ğŸ’¡ ê°€ëŠ¥í•œ ì›ì¸:"),console.error("  1. ìƒŒë“œë°•ìŠ¤ í™˜ê²½ (í”„ë¡œë•ì…˜ ëª¨ë“œë¡œ ì „í™˜ í•„ìš”)"),console.error("  2. í† ìŠ¤ ì•± ë²„ì „ì´ ë‚®ìŒ (SDK 1.0.3 ì´ìƒ í•„ìš”)"),console.error("  3. iOS ì•± ì¶”ì  ëª¨ë“œ í™œì„±í™”ë¨ (ì„¤ì •ì—ì„œ í•´ì œ í•„ìš”)"),console.error("  4. WebView í™˜ê²½ì´ ì•„ë‹˜ (í† ìŠ¤ ì•±ì—ì„œë§Œ ì§€ì›)"),window.showTossModal&&window.showTossModal({title:"ê´‘ê³ ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤",message:"Toss ì•±ì—ì„œë§Œ ê´‘ê³ ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nì•± ë²„ì „ì´ ë‚®ê±°ë‚˜ ìƒŒë“œë°•ìŠ¤ í™˜ê²½ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",buttons:[{text:"í™•ì¸",color:"secondary"}]}),!1}if(await this.loadRewardedAd(o),!this.isAdReady)return console.warn("âŒ ê´‘ê³ ê°€ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤"),window.showTossModal&&window.showTossModal({title:"ê´‘ê³  ë¡œë”© ì¤‘",message:"ê´‘ê³ ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤.\nì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",buttons:[{text:"í™•ì¸",color:"primary"}]}),!1;if(!this.adGroupId)return console.error("âŒ ê´‘ê³  ê·¸ë£¹ IDê°€ ì—†ìŠµë‹ˆë‹¤"),!1;try{return await n({options:{adGroupId:this.adGroupId},onEvent:o=>{switch(console.log("ğŸ“º ê´‘ê³  ì´ë²¤íŠ¸:",o.type),o.type){case"show":case"impression":console.log("ğŸ“º ê´‘ê³  í‘œì‹œ ì¤‘"),"function"==typeof window.pauseAllAudio&&window.pauseAllAudio();break;case"dismissed":console.log("ê´‘ê³  ë‹«í˜"),"function"==typeof window.resumeAllAudio&&window.resumeAllAudio(),this.isAdReady=!1;break;case"userEarnedReward":console.log("âœ… ë³´ìƒ íšë“:",o.data),e&&e(o.data);break;case"clicked":console.log("ê´‘ê³  í´ë¦­ë¨");break;case"failedToShow":console.error("âŒ ê´‘ê³  í‘œì‹œ ì‹¤íŒ¨"),"function"==typeof window.resumeAllAudio&&window.resumeAllAudio(),window.showTossModal&&window.showTossModal({title:"ê´‘ê³  í‘œì‹œ ì‹¤íŒ¨",message:"ê´‘ê³ ë¥¼ í‘œì‹œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\në‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",buttons:[{text:"í™•ì¸",color:"secondary"}]})}},onError:o=>{console.error("âŒ ê´‘ê³  í‘œì‹œ ì—ëŸ¬:",o),"function"==typeof window.resumeAllAudio&&window.resumeAllAudio(),window.showTossModal&&window.showTossModal({title:"ê´‘ê³  í‘œì‹œ ì˜¤ë¥˜",message:"ê´‘ê³ ë¥¼ í‘œì‹œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\në‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",buttons:[{text:"í™•ì¸",color:"secondary"}]})}}),!0}catch(o){return console.error("ê´‘ê³  í‘œì‹œ ì—ëŸ¬:",o),"function"==typeof window.resumeAllAudio&&window.resumeAllAudio(),!1}}}const tossIntegration=new TossIntegration;function waitForTossSDK(o=5e3){return new Promise(e=>{const s=Date.now(),n=()=>{void 0!==window.getUserKeyForGame||void 0!==window.submitGameCenterLeaderBoardScore||void 0!==window.openGameCenterLeaderboard||void 0!==window.GoogleAdMob&&window.GoogleAdMob.loadAppsInTossAdMob||void 0!==window.contactsViral?(console.log("âœ… Toss SDK ë¡œë“œ ì™„ë£Œ"),console.log("ë¡œë“œëœ SDK í•¨ìˆ˜:"),console.log("  - getUserKeyForGame:",void 0!==window.getUserKeyForGame),console.log("  - submitGameCenterLeaderBoardScore:",void 0!==window.submitGameCenterLeaderBoardScore),console.log("  - openGameCenterLeaderboard:",void 0!==window.openGameCenterLeaderboard),console.log("  - GoogleAdMob:",void 0!==window.GoogleAdMob),void 0!==window.GoogleAdMob&&(console.log("    - loadAppsInTossAdMob:","function"==typeof window.GoogleAdMob.loadAppsInTossAdMob),console.log("    - showAppsInTossAdMob:","function"==typeof window.GoogleAdMob.showAppsInTossAdMob)),console.log("  - contactsViral:",void 0!==window.contactsViral),e(!0)):Date.now()-s>o?(console.warn("âš ï¸ Toss SDK ë¡œë“œ íƒ€ì„ì•„ì›ƒ (ë¡œì»¬ í…ŒìŠ¤íŠ¸ ëª¨ë“œ)"),e(!1)):setTimeout(n,100)};n()})}window.tossIntegration=tossIntegration,window.addEventListener("DOMContentLoaded",async()=>{console.log("ğŸš€ Toss Integration ì´ˆê¸°í™” ì‹œì‘"),console.log("=== í™˜ê²½ ì²´í¬ ===");const o=window.getOperationalEnvironment?window.getOperationalEnvironment():"undefined",e=window.getTossAppVersion?window.getTossAppVersion():"undefined",s=window.getPlatformOS?window.getPlatformOS():"undefined";if(console.log("ğŸŒ ì‹¤í–‰ í™˜ê²½:",o),console.log("ğŸ“± Toss ì•± ë²„ì „:",e),console.log("ğŸ’» í”Œë«í¼:",s),console.log("\n=== SDK í•¨ìˆ˜ ì²´í¬ ==="),console.log("window.GoogleAdMob:",typeof window.GoogleAdMob),console.log("window.submitGameCenterLeaderBoardScore:",typeof window.submitGameCenterLeaderBoardScore),console.log("window.openGameCenterLeaderboard:",typeof window.openGameCenterLeaderboard),console.log("window.contactsViral:",typeof window.contactsViral),window.GoogleAdMob&&(console.log("\n=== GoogleAdMob ìƒì„¸ ==="),console.log("GoogleAdMob.loadAppsInTossAdMob:",typeof window.GoogleAdMob.loadAppsInTossAdMob),console.log("GoogleAdMob.showAppsInTossAdMob:",typeof window.GoogleAdMob.showAppsInTossAdMob),"function"==typeof window.GoogleAdMob.loadAppsInTossAdMob?.isSupported)){const s=window.GoogleAdMob.loadAppsInTossAdMob.isSupported();console.log("loadAppsInTossAdMob.isSupported():",s),s||(console.error("âš ï¸ ê´‘ê³  ì§€ì› ì•ˆ ë¨!"),console.error("â†’ í™˜ê²½:",o),console.error("â†’ Toss ë²„ì „:",e),console.error("â†’ í•„ìš” ë²„ì „: 5.221.0 ì´ìƒ"))}window.openGameCenterLeaderboard&&(console.log("\n=== ë¦¬ë”ë³´ë“œ ì²´í¬ ==="),"function"==typeof window.openGameCenterLeaderboard.isSupported&&console.log("openGameCenterLeaderboard.isSupported():",window.openGameCenterLeaderboard.isSupported())),window.submitGameCenterLeaderBoardScore&&(console.log("\n=== ì ìˆ˜ ì œì¶œ ì²´í¬ ==="),"function"==typeof window.submitGameCenterLeaderBoardScore.isSupported&&console.log("submitGameCenterLeaderBoardScore.isSupported():",window.submitGameCenterLeaderBoardScore.isSupported())),await waitForTossSDK();const n=await tossIntegration.initialize();console.log("\n=== ê¸°ëŠ¥ ê°€ìš©ì„± ìµœì¢… ì²´í¬ ===");const t=tossIntegration.isLeaderboardAvailable(),r=tossIntegration.isAdAvailable(),i=tossIntegration.isInviteFriendsAvailable();console.log("ğŸ“Š ë¦¬ë”ë³´ë“œ:",t?"âœ… ì‚¬ìš© ê°€ëŠ¥":"âŒ ì‚¬ìš© ë¶ˆê°€"),console.log("ğŸ“º ê´‘ê³ :",r?"âœ… ì‚¬ìš© ê°€ëŠ¥":"âŒ ì‚¬ìš© ë¶ˆê°€"),console.log("ğŸ‘¥ ì¹œêµ¬ ì´ˆëŒ€:",i?"âœ… ì‚¬ìš© ê°€ëŠ¥":"âŒ ì‚¬ìš© ë¶ˆê°€"),t||r||i||(console.error("âš ï¸ ëª¨ë“  SDK ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!"),console.error("â†’ Toss ì•±ì—ì„œ ì‹¤í–‰í•˜ê³  ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”."),console.error("â†’ í˜„ì¬ í™˜ê²½:",o),console.error("â†’ Toss ë²„ì „:",e)),n?(console.log("âœ… Toss Apps-in-Toss ì—°ë™ ì™„ë£Œ"),await tossIntegration.loadRewardedAd("ait.live.93f320e4e9504159"),tossIntegration.userInfo&&document.body.setAttribute("data-toss-user","authenticated")):(console.log("â„¹ï¸ Toss ì¸ì¦ ì—†ìŒ (ì¼ë°˜ ëª¨ë“œ)"),await tossIntegration.loadRewardedAd("ait.live.93f320e4e9504159")),"function"==typeof window.initializeHeartSystem&&await window.initializeHeartSystem()});